<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfitPilot - Gerenciador de Preços</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Estilo para a tabela no PDF (ajuda a formatar melhor) */
        #productTableForPDF {
            width: 100%;
            border-collapse: collapse;
        }
        #productTableForPDF th, #productTableForPDF td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #productTableForPDF th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body class="bg-[#121212]">
    
    <header class="bg-[#1E1E1E] shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-2xl font-bold text-[#00FF88]">ProfitPilot</h1>
        </div>
    </header>
<main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-[#1E1E1E] rounded-lg shadow-md p-6 border border-[#333]">
<h2 class="text-2xl font-bold text-gray-800 mb-6">Adicionar Produto</h2>
                <form id="productForm" class="space-y-4">
                    <div>
                        <label for="productName" class="block text-sm font-medium text-gray-700">Nome do Produto*</label>
                        <input type="text" id="productName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-black">
</div>
                    
                    <div>
                        <label for="productCode" class="block text-sm font-medium text-gray-700">Código (Opcional)</label>
                        <input type="text" id="productCode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-black">
</div>
                    
                    <div>
                        <label for="purchasePrice" class="block text-sm font-medium text-gray-700">Valor de Compra*</label>
                        <input type="number" step="0.01" id="purchasePrice" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-black">
</div>
                    
                    <div>
                        <label for="profitPercentage" class="block text-sm font-medium text-gray-700">Porcentagem de Lucro*</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="profitPercentage" required class="block w-full rounded-none rounded-l-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 text-black">
<span class="inline-flex items-center rounded-r-md border border-l-0 border-gray-300 bg-gray-50 px-3 text-gray-500">%</span>
                        </div>
                    </div>
                    
                    <div>
                        <label for="quantity" class="block text-sm font-medium text-gray-700">Quantidade*</label>
                        <input type="number" id="quantity" required min="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-black">
</div>
                    
                    <div>
                        <label for="productImage" class="block text-sm font-medium text-gray-700">Foto do Produto (Opcional)</label>
                        <input type="file" id="productImage" accept="image/*" class="mt-1 block w-full text-sm text-black file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
</div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#00FF88] hover:bg-[#00CC6A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00FF88] text-[#121212] font-bold">
Adicionar Produto
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Pré-visualização</h2>
                <div id="preview" class="space-y-4">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Nome:</span>
                        <span id="previewName" class="font-medium">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Código:</span>
                        <span id="previewCode" class="font-medium">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Valor de Compra:</span>
                        <span id="previewPurchase" class="font-medium">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Porcentagem:</span>
                        <span id="previewPercentage" class="font-medium">0%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Valor de Venda:</span>
                        <span id="previewSale" class="font-medium text-green-600">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Quantidade:</span>
                        <span id="previewQuantity" class="font-medium">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Total Compra:</span>
                        <span id="previewTotalPurchase" class="font-medium">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Total Venda:</span>
                        <span id="previewTotalSale" class="font-medium text-green-600">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between border-t pt-2">
                        <span class="text-gray-600 font-bold">Lucro Estimado:</span>
                        <span id="previewProfit" class="font-bold text-green-600">R$ 0,00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-12 bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Catálogo de Produtos</h2>
                <div class="flex space-x-2">
                    <button id="exportPdf" class="inline-flex items-center px-4 py-2 border border-[#333] rounded-md shadow-sm text-sm font-medium text-white bg-[#1E1E1E] hover:bg-[#333] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00FF88]">
                        <i data-feather="download" class="mr-2"></i> Exportar PDF
                    </button>
                    <button id="clearAll" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#FF6B35] hover:bg-[#E05A2B] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FF6B35]">
<i data-feather="trash-2" class="mr-2"></i> Limpar Tudo
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table id="productTableForPDF" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compra (un)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% Lucro</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Venda (un)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Compra</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Venda</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lucro</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="productList" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
            
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-medium text-gray-800 mb-4">Resumo Financeiro</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500">Total Investido</p>
                        <p id="totalInvested" class="text-2xl font-bold text-gray-800">R$ 0,00</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500">Total de Venda</p>
                        <p id="totalSales" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-500">Lucro Estimado</p>
                        <p id="totalProfit" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div id="editModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Editar Produto</h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-500">
                    <i data-feather="x"></i>
                </button>
            </div>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div>
                    <label for="editName" class="block text-sm font-medium text-gray-700">Nome do Produto*</label>
                    <input type="text" id="editName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="editCode" class="block text-sm font-medium text-gray-700">Código (Opcional)</label>
                    <input type="text" id="editCode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="editPurchase" class="block text-sm font-medium text-gray-700">Valor de Compra*</label>
                    <input type="number" step="0.01" id="editPurchase" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="editPercentage" class="block text-sm font-medium text-gray-700">Porcentagem de Lucro*</label>
                    <div class="mt-1 flex rounded-md shadow-sm">
                        <input type="number" id="editPercentage" required class="block w-full rounded-none rounded-l-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                        <span class="inline-flex items-center rounded-r-md border border-l-0 border-gray-300 bg-gray-50 px-3 text-gray-500">%</span>
                    </div>
                </div>
                <div>
                    <label for="editQuantity" class="block text-sm font-medium text-gray-700">Quantidade*</label>
                    <input type="number" id="editQuantity" required min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div class="pt-4 flex justify-end space-x-3">
                <button type="button" id="cancelEdit" class="inline-flex justify-center py-2 px-4 border border-[#333] shadow-sm text-sm font-medium rounded-md text-white bg-[#1E1E1E] hover:bg-[#333] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00FF88]">
                    Cancelar
                </button>
                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-[#121212] bg-[#00FF88] hover:bg-[#00CC6A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00FF88] font-bold">
Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productForm = document.getElementById('productForm');
            const productList = document.getElementById('productList');
            const clearAllButton = document.getElementById('clearAll');
            const exportPdfButton = document.getElementById('exportPdf');
            const previewElements = {
                name: document.getElementById('previewName'),
                code: document.getElementById('previewCode'),
                purchase: document.getElementById('previewPurchase'),
                percentage: document.getElementById('previewPercentage'),
                sale: document.getElementById('previewSale'),
                quantity: document.getElementById('previewQuantity'),
                totalPurchase: document.getElementById('previewTotalPurchase'),
                totalSale: document.getElementById('previewTotalSale'),
                profit: document.getElementById('previewProfit')
            };
            const financeSummary = {
                invested: document.getElementById('totalInvested'),
                sales: document.getElementById('totalSales'),
                profit: document.getElementById('totalProfit')
            };

            // Modal elements
            const editModal = document.getElementById('editModal');
            const editForm = document.getElementById('editForm');
            const closeModalButton = document.getElementById('closeModal');
            const cancelEditButton = document.getElementById('cancelEdit');

            let products = JSON.parse(localStorage.getItem('products')) || [];

            // --- FUNÇÕES DE UTILIDADE ---

            const formatCurrency = (value) => {
                return `R$ ${parseFloat(value).toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.')}`;
            };

            const calculateSalePrice = (purchase, percentage) => {
                return purchase * (1 + percentage / 100);
            };

            const updatePreview = () => {
                const name = document.getElementById('productName').value || '-';
                const code = document.getElementById('productCode').value || '-';
                const purchase = parseFloat(document.getElementById('purchasePrice').value) || 0;
                const percentage = parseFloat(document.getElementById('profitPercentage').value) || 0;
                const quantity = parseInt(document.getElementById('quantity').value) || 0;

                const salePrice = calculateSalePrice(purchase, percentage);
                const totalPurchase = purchase * quantity;
                const totalSale = salePrice * quantity;
                const profit = totalSale - totalPurchase;

                previewElements.name.textContent = name;
                previewElements.code.textContent = code;
                previewElements.purchase.textContent = formatCurrency(purchase);
                previewElements.percentage.textContent = `${percentage}%`;
                previewElements.sale.textContent = formatCurrency(salePrice);
                previewElements.quantity.textContent = quantity;
                previewElements.totalPurchase.textContent = formatCurrency(totalPurchase);
                previewElements.totalSale.textContent = formatCurrency(totalSale);
                previewElements.profit.textContent = formatCurrency(profit);
            };

            // --- GESTÃO DE PRODUTOS ---

            const saveProducts = () => {
                localStorage.setItem('products', JSON.stringify(products));
                renderProducts();
                updateSummary();
            };

            const createProductRow = (product, index) => {
                const salePrice = calculateSalePrice(product.purchasePrice, product.profitPercentage);
                const totalPurchase = product.purchasePrice * product.quantity;
                const totalSale = salePrice * product.quantity;
                const profit = totalSale - totalPurchase;

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-100';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.name}" class="h-10 w-10 rounded-full object-cover">` : '<div class="h-10 w-10 bg-gray-200 rounded-full flex items-center justify-center text-xs text-gray-500">SEM FOTO</div>'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${product.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${product.code || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${formatCurrency(product.purchasePrice)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${product.profitPercentage}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-green-600">${formatCurrency(salePrice)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">${product.quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-900 font-bold">${formatCurrency(totalPurchase)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-green-600 font-bold">${formatCurrency(totalSale)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-green-600 font-bold">${formatCurrency(profit)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-id="${product.id}" class="edit-btn text-indigo-600 hover:text-indigo-900 mr-2">
                            <i data-feather="edit" class="w-4 h-4"></i>
                        </button>
                        <button data-id="${product.id}" class="delete-btn text-red-600 hover:text-red-900">
                            <i data-feather="trash-2" class="w-4 h-4"></i>
                        </button>
                    </td>
                `;
                return row;
            };

            const renderProducts = () => {
                productList.innerHTML = '';
                if (products.length === 0) {
                    productList.innerHTML = `<tr><td colspan="11" class="px-6 py-4 text-center text-gray-500">Nenhum produto no catálogo.</td></tr>`;
                    return;
                }

                products.forEach((product, index) => {
                    const row = createProductRow(product, index);
                    productList.appendChild(row);
                });
                
                // Re-inicializa os ícones após renderizar as linhas
                feather.replace();
            };
            
            const updateSummary = () => {
                const totalInvested = products.reduce((sum, p) => sum + (p.purchasePrice * p.quantity), 0);
                const totalSales = products.reduce((sum, p) => sum + (calculateSalePrice(p.purchasePrice, p.profitPercentage) * p.quantity), 0);
                const totalProfit = totalSales - totalInvested;
                
                financeSummary.invested.textContent = formatCurrency(totalInvested);
                financeSummary.sales.textContent = formatCurrency(totalSales);
                financeSummary.profit.textContent = formatCurrency(totalProfit);
            };

            // --- EVENT LISTENERS E HANDLERS ---
            
            // 1. Adicionar Produto
            productForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const reader = new FileReader();
                const imageFile = document.getElementById('productImage').files[0];

                const addProduct = (imageUrl = null) => {
                    const newProduct = {
                        id: Date.now(), // ID único baseado no timestamp
                        name: document.getElementById('productName').value,
                        code: document.getElementById('productCode').value,
                        purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                        profitPercentage: parseFloat(document.getElementById('profitPercentage').value),
                        quantity: parseInt(document.getElementById('quantity').value),
                        imageUrl: imageUrl
                    };

                    products.push(newProduct);
                    saveProducts();
                    productForm.reset();
                    updatePreview(); // Limpa a pré-visualização
                    
                    alert('Produto adicionado com sucesso!');
                };

                if (imageFile) {
                    // Converte a imagem para Base64 para armazenar no localStorage
                    reader.onloadend = () => {
                        addProduct(reader.result);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    addProduct(null);
                }
            });

            // 2. Atualizar Pré-visualização
            ['productName', 'productCode', 'purchasePrice', 'profitPercentage', 'quantity'].forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', updatePreview);
            });
            updatePreview(); // Inicializa a pré-visualização

            // 3. Ações da Tabela (Editar e Deletar)
            productList.addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                const productId = parseInt(target.dataset.id);

                if (target.classList.contains('delete-btn')) {
                    if (confirm('Tem certeza de que deseja excluir este produto?')) {
                        products = products.filter(p => p.id !== productId);
                        saveProducts();
                    }
                } else if (target.classList.contains('edit-btn')) {
                    const productToEdit = products.find(p => p.id === productId);
                    if (productToEdit) {
                        document.getElementById('editId').value = productToEdit.id;
                        document.getElementById('editName').value = productToEdit.name;
                        document.getElementById('editCode').value = productToEdit.code;
                        document.getElementById('editPurchase').value = productToEdit.purchasePrice;
                        document.getElementById('editPercentage').value = productToEdit.profitPercentage;
                        document.getElementById('editQuantity').value = productToEdit.quantity;
                        
                        editModal.classList.remove('hidden');
                    }
                }
            });

            // 4. Salvar Edição
            editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('editId').value);
                const index = products.findIndex(p => p.id === id);

                if (index !== -1) {
                    products[index].name = document.getElementById('editName').value;
                    products[index].code = document.getElementById('editCode').value;
                    products[index].purchasePrice = parseFloat(document.getElementById('editPurchase').value);
                    products[index].profitPercentage = parseFloat(document.getElementById('editPercentage').value);
                    products[index].quantity = parseInt(document.getElementById('editQuantity').value);

                    saveProducts();
                    editModal.classList.add('hidden');
                }
            });
            
            // Fechar Modal
            [closeModalButton, cancelEditButton].forEach(btn => {
                btn.addEventListener('click', () => {
                    editModal.classList.add('hidden');
                });
            });

            // 5. Limpar Tudo
            clearAllButton.addEventListener('click', () => {
                if (confirm('ATENÇÃO: Isso limpará todos os produtos e o resumo financeiro. Tem certeza?')) {
                    products = [];
                    saveProducts();
                    alert('Catálogo limpo com sucesso!');
                }
            });
            
            // 6. Exportar PDF
            exportPdfButton.addEventListener('click', () => {
                if (products.length === 0) {
                    alert('Adicione produtos para exportar o PDF.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4'); // 'l' para layout paisagem (melhor para tabelas largas)
                
                const table = document.querySelector('#productTableForPDF').cloneNode(true);
                
                // Remove a coluna "Ações" da cópia para o PDF
                table.querySelectorAll('tr').forEach(row => {
                    // Remove a última célula (Ações)
                    row.deleteCell(row.cells.length - 1);
                });
                
                // Cria um elemento temporário para renderizar o HTML da tabela
                const tempDiv = document.createElement('div');
                tempDiv.style.padding = '10px';
                tempDiv.style.backgroundColor = '#fff';
                tempDiv.appendChild(table);
                document.body.appendChild(tempDiv);
                
                // html2canvas para renderizar o HTML em uma imagem
                html2canvas(table, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const imgWidth = 280; // A4 em mm paisagem (297mm - 17mm de margem total)
                    const pageHeight = 210;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    
                    let position = 5; // Posição inicial
                    
                    doc.setFontSize(18);
                    doc.text('Catálogo de Produtos - ProfitPilot', 10, 15);
                    doc.setFontSize(10);
                    doc.text(`Data de Exportação: ${new Date().toLocaleDateString('pt-BR')}`, 10, 22);

                    // Adicionar a imagem/tabela
                    doc.addImage(imgData, 'JPEG', 8, 30, imgWidth, imgHeight);
                    heightLeft -= (pageHeight - 30); // Calcula o que resta

                    // Lidar com múltiplas páginas
                    let y = 30 + imgHeight;
                    while (heightLeft > 0) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'JPEG', 8, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // Adicionar resumo financeiro na última página
                    doc.setFontSize(12);
                    doc.text('Resumo Financeiro:', 10, y + 10);
                    doc.text(`Total Investido: ${financeSummary.invested.textContent}`, 10, y + 17);
                    doc.text(`Total de Venda: ${financeSummary.sales.textContent}`, 10, y + 24);
                    doc.text(`Lucro Estimado: ${financeSummary.profit.textContent}`, 10, y + 31);

                    doc.save('Catalogo_ProfitPilot.pdf');
                    
                    // Remove o elemento temporário
                    document.body.removeChild(tempDiv);
                });
            });

            // 7. Inicialização
            renderProducts();
            updateSummary();
        });
        
        feather.replace(); // Inicializa os ícones do Feather
    </script>
</body>
</html>